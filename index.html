<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dofus Farm Tracker</title>
    <style>
        /* CSS pour le design Neumorphism sombre */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

        :root {
            --dark-bg: #212121;
            --dark-element: #2A2A2A;
            --light-shadow: #424242;
            --dark-shadow: #161616;
            --text-color: #f0f0f0;
            --positive: #4CAF50; /* Vert pour les bénéfices */
            --negative: #F44336; /* Rouge pour les pertes */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
            padding: 30px;
            background-color: var(--dark-element);
            border-radius: 20px;
            box-shadow: 8px 8px 16px var(--dark-shadow), -8px -8px 16px var(--light-shadow);
            text-align: center;
        }

        h1 {
            font-weight: 600;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px var(--dark-shadow), -2px -2px 4px var(--light-shadow);
        }

        .neuf-button {
            background-color: var(--dark-element);
            color: var(--text-color);
            border: none;
            border-radius: 15px;
            padding: 12px 25px;
            margin: 10px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 6px 6px 12px var(--dark-shadow), -6px -6px 12px var(--light-shadow);
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .neuf-button:hover {
            box-shadow: inset 4px 4px 8px var(--dark-shadow), inset -4px -4px 8px var(--light-shadow);
        }

        .neuf-button:active {
            box-shadow: inset 4px 4px 8px var(--dark-shadow), inset -4px -4px 8px var(--light-shadow);
        }

        .neuf-card {
            background-color: var(--dark-element);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: inset 4px 4px 8px var(--dark-shadow), inset -4px -4px 8px var(--light-shadow);
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            background-color: var(--dark-bg);
            color: var(--text-color);
            border: none;
            border-radius: 10px;
            box-shadow: inset 4px 4px 8px var(--dark-shadow), inset -4px -4px 8px var(--light-shadow);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            font-family: inherit;
        }

        #transaction-list {
            list-style: none;
            padding: 0;
        }

        #transaction-list li {
            background-color: var(--dark-element);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 4px 4px 8px var(--dark-shadow), -4px -4px 8px var(--light-shadow);
        }
        
        .positive {
            color: var(--positive);
        }

        .negative {
            color: var(--negative);
        }
    </style>
</head>
<body>

    <div class="container" id="main-view">
        <h1>Mon Bilan Dofus Touch</h1>
        <div class="neuf-card">
            <h2>Récapitulatif</h2>
            <p>Total des achats : <span id="total-achats">0</span> K</p>
            <p>Total des ventes : <span id="total-ventes">0</span> K</p>
            <h3 id="benefice">Bénéfice : <span>0</span> K</h3>
        </div>

        <div class="neuf-card">
            <h2>Historique des transactions</h2>
            <ul id="transaction-list"></ul>
        </div>

        <nav>
            <button id="show-achat" class="neuf-button">Ajouter un achat</button>
            <button id="show-revente" class="neuf-button">Ajouter une revente</button>
        </nav>
    </div>

    <div class="container" id="achat-view" style="display:none;">
        <h1>Ajouter un achat</h1>
        <form id="form-achat">
            <div class="neuf-card">
                <label for="objet-achat">Nom de l'objet :</label>
                <input list="dofus-items" id="objet-achat" name="objet">
                <datalist id="dofus-items"></datalist>

                <label for="quantite-achat">Quantité :</label>
                <select id="quantite-achat" name="quantite">
                    <option value="1">1</option>
                    <option value="10">10</option>
                    <option value="100">100</option>
                    <option value="1000">1000</option>
                </select>

                <label for="prix-achat">Prix d'achat unitaire (K) :</label>
                <input type="number" id="prix-achat" name="prix" required>
            </div>
            <button type="submit" class="neuf-button">Enregistrer l'achat</button>
        </form>
        <button id="back-to-main-achat" class="neuf-button">Retour au bilan</button>
    </div>

    <div class="container" id="revente-view" style="display:none;">
        <h1>Ajouter une revente</h1>
        <form id="form-revente">
            <div class="neuf-card">
                <label for="objet-revente">Nom de l'objet :</label>
                <input list="dofus-items" id="objet-revente" name="objet">
                <datalist id="dofus-items"></datalist>
                
                <label for="quantite-revente">Quantité :</label>
                <select id="quantite-revente" name="quantite">
                    <option value="1">1</option>
                    <option value="10">10</option>
                    <option value="100">100</option>
                    <option value="1000">1000</option>
                </select>

                <label for="prix-revente">Prix de revente unitaire (K) :</label>
                <input type="number" id="prix-revente" name="prix" required>
            </div>
            <button type="submit" class="neuf-button">Enregistrer la revente</button>
        </form>
        <button id="back-to-main-revente" class="neuf-button">Retour au bilan</button>
    </div>

    <script>
        // JavaScript pour la logique de l'application
        const ACHATS_KEY = 'dofusAchats';
        const REVENTES_KEY = 'dofusReventes';

        const mainView = document.getElementById('main-view');
        const achatView = document.getElementById('achat-view');
        const reventeView = document.getElementById('revente-view');

        const showAchatBtn = document.getElementById('show-achat');
        const showReventeBtn = document.getElementById('show-revente');
        const backToMainAchatBtn = document.getElementById('back-to-main-achat');
        const backToMainReventeBtn = document.getElementById('back-to-main-revente');

        // Fonctions de navigation
        function showView(view) {
            mainView.style.display = 'none';
            achatView.style.display = 'none';
            reventeView.style.display = 'none';
            view.style.display = 'block';
            if (view === mainView) {
                updateMainView();
            }
        }

        showAchatBtn.addEventListener('click', () => showView(achatView));
        showReventeBtn.addEventListener('click', () => showView(reventeView));
        backToMainAchatBtn.addEventListener('click', () => showView(mainView));
        backToMainReventeBtn.addEventListener('click', () => showView(mainView));

        // Fonctions pour gérer le localStorage
        function getTransactions(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : [];
        }

        function saveTransactions(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // Fonction pour mettre à jour l'affichage de la page principale
        function updateMainView() {
            const achats = getTransactions(ACHATS_KEY);
            const reventes = getTransactions(REVENTES_KEY);

            let totalAchats = 0;
            let totalVentes = 0;

            achats.forEach(item => totalAchats += item.quantite * item.prix);
            reventes.forEach(item => totalVentes += item.quantite * item.prix);

            const benefice = totalVentes - totalAchats;

            document.getElementById('total-achats').textContent = totalAchats;
            document.getElementById('total-ventes').textContent = totalVentes;
            const beneficeElement = document.getElementById('benefice').querySelector('span');
            beneficeElement.textContent = benefice;

            if (benefice > 0) {
                beneficeElement.className = 'positive';
            } else if (benefice < 0) {
                beneficeElement.className = 'negative';
            } else {
                beneficeElement.className = '';
            }

            const transactionList = document.getElementById('transaction-list');
            transactionList.innerHTML = ''; // Nettoyer la liste avant d'ajouter les éléments

            const allTransactions = [...achats.map(t => ({...t, type: 'Achat'})), ...reventes.map(t => ({...t, type: 'Revente'}))];
            allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));

            allTransactions.forEach(transaction => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${transaction.type} :</strong> ${transaction.quantite}x ${transaction.objet} pour ${transaction.quantite * transaction.prix} K`;
                transactionList.appendChild(li);
            });
        }

        // Chargement initial des objets Dofus Touch
        async function loadDofusItems() {
            try {
                const response = await fetch('https://fr.touch.dofapi.fr/items');
                const items = await response.json();
                
                const datalist = document.getElementById('dofus-items');
                if (datalist) {
                    items.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.name.fr;
                        datalist.appendChild(option);
                    });
                }
            } catch (error) {
                console.error("Erreur lors du chargement des items :", error);
            }
        }

        // Gestion du formulaire d'achat
        const formAchat = document.getElementById('form-achat');
        formAchat.addEventListener('submit', (e) => {
            e.preventDefault();
            const objet = document.getElementById('objet-achat').value;
            const quantite = parseInt(document.getElementById('quantite-achat').value);
            const prix = parseInt(document.getElementById('prix-achat').value);

            const nouvelleTransaction = {
                objet,
                quantite,
                prix,
                date: new Date().toISOString()
            };

            const achats = getTransactions(ACHATS_KEY);
            achats.push(nouvelleTransaction);
            saveTransactions(ACHATS_KEY, achats);

            alert('Achat enregistré !');
            formAchat.reset();
            showView(mainView);
        });

        // Gestion du formulaire de revente
        const formRevente = document.getElementById('form-revente');
        formRevente.addEventListener('submit', (e) => {
            e.preventDefault();
            const objet = document.getElementById('objet-revente').value;
            const quantite = parseInt(document.getElementById('quantite-revente').value);
            const prix = parseInt(document.getElementById('prix-revente').value);

            const nouvelleTransaction = {
                objet,
                quantite,
                prix,
                date: new Date().toISOString()
            };

            const reventes = getTransactions(REVENTES_KEY);
            reventes.push(nouvelleTransaction);
            saveTransactions(REVENTES_KEY, reventes);

            alert('Revente enregistrée !');
            formRevente.reset();
            showView(mainView);
        });

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', () => {
            loadDofusItems();
            updateMainView();
        });
    </script>
</body>
</html>
