<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dofus Farm Tracker</title>
    <style>
        /* CSS pour le design Neumorphism sombre */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

        :root {
            --dark-bg: #212121;
            --dark-element: #2A2A2A;
            --light-shadow: #424242;
            --dark-shadow: #161616;
            --text-color: #f0f0f0;
            --positive: #4CAF50; /* Vert pour les bénéfices */
            --negative: #F44336; /* Rouge pour les pertes */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
            padding: 30px;
            background-color: var(--dark-element);
            border-radius: 20px;
            box-shadow: 8px 8px 16px var(--dark-shadow), -8px -8px 16px var(--light-shadow);
            text-align: center;
        }

        h1 {
            font-weight: 600;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px var(--dark-shadow), -2px -2px 4px var(--light-shadow);
        }

        .neuf-button {
            background-color: var(--dark-element);
            color: var(--text-color);
            border: none;
            border-radius: 15px;
            padding: 12px 25px;
            margin: 10px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 6px 6px 12px var(--dark-shadow), -6px -6px 12px var(--light-shadow);
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .neuf-button:hover {
            box-shadow: inset 4px 4px 8px var(--dark-shadow), inset -4px -4px 8px var(--light-shadow);
        }

        .neuf-button:active {
            box-shadow: inset 4px 4px 8px var(--dark-shadow), inset -4px -4px 8px var(--light-shadow);
        }

        .neuf-card {
            background-color: var(--dark-element);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: inset 4px 4px 8px var(--dark-shadow), inset -4px -4px 8px var(--light-shadow);
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            background-color: var(--dark-bg);
            color: var(--text-color);
            border: none;
            border-radius: 10px;
            box-shadow: inset 4px 4px 8px var(--dark-shadow), inset -4px -4px 8px var(--light-shadow);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            font-family: inherit;
        }

        #transaction-list {
            list-style: none;
            padding: 0;
        }

        #transaction-list li {
            background-color: var(--dark-element);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 4px 4px 8px var(--dark-shadow), -4px -4px 8px var(--light-shadow);
        }
        
        .positive {
            color: var(--positive);
        }

        .negative {
            color: var(--negative);
        }

        /* Styles pour les modales */
        .modal-overlay {
            display: none; /* Caché par défaut */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Fond semi-transparent */
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--dark-element);
            border-radius: 20px;
            box-shadow: 8px 8px 16px var(--dark-shadow), -8px -8px 16px var(--light-shadow);
            padding: 30px;
            max-width: 600px;
            width: 90%;
            position: relative; /* Pour le bouton de fermeture */
            text-align: center;
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5em;
            color: var(--text-color);
            cursor: pointer;
            line-height: 1;
        }

        .close-button:hover {
            color: var(--light-shadow);
        }
    </style>
</head>
<body>

    <div class="container" id="main-view">
        <h1>Mon Bilan Dofus Touch</h1>
        <div class="neuf-card">
            <h2>Récapitulatif</h2>
            <p>Total des achats : <span id="total-achats">0</span> K</p>
            <p>Total des ventes : <span id="total-ventes">0</span> K</p>
            <h3 id="benefice">Bénéfice : <span>0</span> K</h3>
        </div>

        <div class="neuf-card">
            <h2>Historique des transactions</h2>
            <ul id="transaction-list"></ul>
        </div>

        <nav>
            <button id="show-achat" class="neuf-button">Ajouter un achat</button>
            <button id="show-revente" class="neuf-button">Ajouter une revente</button>
        </nav>
    </div>

    <!-- Modale pour ajouter un achat -->
    <div id="achat-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-button" id="close-achat-modal">&times;</button>
            <h1>Ajouter un achat</h1>
            <form id="form-achat">
                <div class="neuf-card">
                    <label for="objet-achat">Nom de l'objet :</label>
                    <input list="dofus-items" id="objet-achat" name="objet">
                    <datalist id="dofus-items"></datalist>

                    <label for="quantite-achat">Quantité :</label>
                    <select id="quantite-achat" name="quantite">
                        <option value="1">1</option>
                        <option value="10">10</option>
                        <option value="100">100</option>
                        <option value="1000">1000</option>
                    </select>

                    <label for="prix-achat">Prix d'achat unitaire (K) :</label>
                    <input type="number" id="prix-achat" name="prix" required>
                </div>
                <button type="submit" class="neuf-button">Enregistrer l'achat</button>
            </form>
        </div>
    </div>

    <!-- Modale pour ajouter une revente -->
    <div id="revente-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-button" id="close-revente-modal">&times;</button>
            <h1>Ajouter une revente</h1>
            <form id="form-revente">
                <div class="neuf-card">
                    <label for="objet-revente">Nom de l'objet :</label>
                    <input list="dofus-items" id="objet-revente" name="objet">
                    <datalist id="dofus-items"></datalist>
                    
                    <label for="quantite-revente">Quantité :</label>
                    <select id="quantite-revente" name="quantite">
                        <option value="1">1</option>
                        <option value="10">10</option>
                        <option value="100">100</option>
                        <option value="1000">1000</option>
                    </select>

                    <label for="prix-revente">Prix de revente unitaire (K) :</label>
                    <input type="number" id="prix-revente" name="prix" required>
                </div>
                <button type="submit" class="neuf-button">Enregistrer la revente</button>
            </form>
        </div>
    </div>

    <script>
        const ACHATS_KEY = 'dofusAchats';
        const REVENTES_KEY = 'dofusReventes';

        const mainView = document.getElementById('main-view');
        const achatModal = document.getElementById('achat-modal');
        const reventeModal = document.getElementById('revente-modal');

        const showAchatBtn = document.getElementById('show-achat');
        const showReventeBtn = document.getElementById('show-revente');
        const closeAchatModalBtn = document.getElementById('close-achat-modal');
        const closeReventeModalBtn = document.getElementById('close-revente-modal');

        // Fonctions pour gérer l'ouverture et la fermeture des modales
        function showModal(modalElement) {
            modalElement.style.display = 'flex'; // Utiliser flex pour centrer le contenu
        }

        function hideModal(modalElement) {
            modalElement.style.display = 'none';
            updateMainView(); // Mettre à jour la vue principale après fermeture de la modale
        }

        // Événements pour ouvrir les modales
        showAchatBtn.addEventListener('click', () => showModal(achatModal));
        showReventeBtn.addEventListener('click', () => showModal(reventeModal));

        // Événements pour fermer les modales via le bouton "x"
        closeAchatModalBtn.addEventListener('click', () => hideModal(achatModal));
        closeReventeModalBtn.addEventListener('click', () => hideModal(reventeModal));

        // Événements pour fermer les modales en cliquant en dehors du contenu
        achatModal.addEventListener('click', (e) => {
            if (e.target === achatModal) {
                hideModal(achatModal);
            }
        });
        reventeModal.addEventListener('click', (e) => {
            if (e.target === reventeModal) {
                hideModal(reventeModal);
            }
        });


        // Fonctions pour gérer le localStorage (aucune modification ici)
        function getTransactions(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : [];
        }

        function saveTransactions(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // Fonction pour mettre à jour l'affichage de la page principale (aucune modification ici)
        function updateMainView() {
            const achats = getTransactions(ACHATS_KEY);
            const reventes = getTransactions(REVENTES_KEY);

            let totalAchats = 0;
            let totalVentes = 0;

            achats.forEach(item => totalAchats += item.quantite * item.prix);
            reventes.forEach(item => totalVentes += item.quantite * item.prix);

            const benefice = totalVentes - totalAchats;

            document.getElementById('total-achats').textContent = totalAchats;
            document.getElementById('total-ventes').textContent = totalVentes;
            const beneficeElement = document.getElementById('benefice').querySelector('span');
            beneficeElement.textContent = benefice;

            if (benefice > 0) {
                beneficeElement.className = 'positive';
            } else if (benefice < 0) {
                beneficeElement.className = 'negative';
            } else {
                beneficeElement.className = '';
            }

            const transactionList = document.getElementById('transaction-list');
            transactionList.innerHTML = ''; 

            const allTransactions = [...achats.map(t => ({...t, type: 'Achat'})), ...reventes.map(t => ({...t, type: 'Revente'}))];
            allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));

            allTransactions.forEach(transaction => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${transaction.type} :</strong> ${transaction.quantite}x ${transaction.objet} pour ${transaction.quantite * transaction.prix} K`;
                transactionList.appendChild(li);
            });
        }

        // Chargement initial des objets Dofus Touch (aucune modification ici)
        async function loadDofusItems() {
            try {
                const response = await fetch('https://fr.touch.dofapi.fr/items');
                const items = await response.json();
                
                const datalist = document.getElementById('dofus-items');
                if (datalist) {
                    items.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.name.fr;
                        datalist.appendChild(option);
                    });
                }
            } catch (error) {
                console.error("Erreur lors du chargement des items :", error);
            }
        }

        // Gestion du formulaire d'achat
        const formAchat = document.getElementById('form-achat');
        formAchat.addEventListener('submit', (e) => {
            e.preventDefault();
            const objet = document.getElementById('objet-achat').value;
            const quantite = parseInt(document.getElementById('quantite-achat').value);
            const prix = parseInt(document.getElementById('prix-achat').value);

            const nouvelleTransaction = {
                objet,
                quantite,
                prix,
                date: new Date().toISOString()
            };

            const achats = getTransactions(ACHATS_KEY);
            achats.push(nouvelleTransaction);
            saveTransactions(ACHATS_KEY, achats);

            alert('Achat enregistré !');
            formAchat.reset();
            hideModal(achatModal); // Ferme la modale d'achat
        });

        // Gestion du formulaire de revente
        const formRevente = document.getElementById('form-revente');
        formRevente.addEventListener('submit', (e) => {
            e.preventDefault();
            const objet = document.getElementById('objet-revente').value;
            const quantite = parseInt(document.getElementById('quantite-revente').value);
            const prix = parseInt(document.getElementById('prix-revente').value);

            const nouvelleTransaction = {
                objet,
                quantite,
                prix,
                date: new Date().toISOString()
            };

            const reventes = getTransactions(REVENTES_KEY);
            reventes.push(nouvelleTransaction);
            saveTransactions(REVENTES_KEY, reventes);

            alert('Revente enregistrée !');
            formRevente.reset();
            hideModal(reventeModal); // Ferme la modale de revente
        });

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', () => {
            loadDofusItems();
            updateMainView();
        });
    </script>
</body>
</html>
